<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ü™ê ARMAJ Trip Picker</title>
<meta name="description" content="Mobile-first, classy-psychedelic trip picker. Animated cosmos, front-layer vote bursts, group voting, bottom-sheet leaderboard." />

<!-- Social preview -->
<meta property="og:title" content="ARMAJ Trip Picker" />
<meta property="og:description" content="Vote on hidden India trips. Starry UI, funny vote bursts, share/import votes, live leaderboard." />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://YOUR-USERNAME.github.io/YOUR-REPO/" />
<meta property="og:image" content="https://YOUR-USERNAME.github.io/YOUR-REPO/cover.png" />
<meta name="twitter:card" content="summary_large_image" />

<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2284%22>ü™ê</text></svg>">

<style>
  :root{
    --fg:#eaf0ff; --muted:#b7c6e9; --line:#1a2342;
    --glass:#0a0f21cc; --glass2:#0a0e1ccc; --hot:#ffd166;
    --card:#0b1126; --card2:#0a0f20; --btn:#0c1333; --btnb:#2a3569;
    --cosmicPurple1:#7b5cff; --cosmicPurple2:#a78bfa; /* for FAB */
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0; color:var(--fg); font-family: ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial; background:#070a16; overflow-x:hidden}

  /* Backdrop layers */
  .nebula{ position:fixed; inset:-25vmax; z-index:-3; filter:blur(80px) saturate(120%);
    background:
      radial-gradient(60vmax 40vmax at 10% 10%, #18223d 0%, transparent 60%),
      radial-gradient(70vmax 50vmax at 85% 15%, #151f3a 0%, transparent 60%),
      radial-gradient(90vmax 60vmax at 40% 90%, #1a2448 0%, transparent 70%);
    opacity:.85; animation: driftNeb 40s ease-in-out infinite alternate;
  }
  @keyframes driftNeb { 0%{transform:translate3d(0,0,0)} 100%{transform:translate3d(2vmin,-2vmin,0)} }

  /* Stars behind content */
  canvas#stars{ position:fixed; inset:0; z-index:-2; display:block; }

  /* Vote bursts ABOVE content (3D-ish) */
  canvas#bursts{
    position:fixed; inset:0; z-index:22; /* header 20, sheet 24, fab 25 */
    display:block; pointer-events:none; mix-blend-mode:screen;
  }

  /* Header (compact) */
  header{position:sticky; top:0; z-index:20; background:var(--glass2); border-bottom:1px solid var(--line); backdrop-filter:blur(10px) saturate(160%)}
  .wrap{max-width:1100px; margin:0 auto; padding:12px 14px}
  .toprow{display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap}
  .brand{display:flex; align-items:center; gap:10px}
  .brand h1{font-size:18px; margin:0; font-weight:900; letter-spacing:.2px}
  .brand .emoji{font-size:22px}
  .bar{display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:8px}
  input[type="search"]{flex:1; min-width:180px; background:#0a1024; color:var(--fg); border:1px solid #23315e; padding:10px 12px; border-radius:12px}
  .btn{background:var(--btn); color:#eaf6ff; border:1px solid var(--btnb); padding:10px 12px; border-radius:12px; cursor:pointer; font-weight:800}
  .btn.hot{background:linear-gradient(90deg,#19d1a3,#87a9ff); color:#041515; border-color:#47e2d4}
  .btn.ghost{background:transparent}
  .hint{color:#9fb3eb; font-size:12px}

  /* Grid */
  main .grid{display:grid; gap:12px; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); padding:12px 14px 140px; max-width:1100px; margin:0 auto}

  /* TRANSLUCENT GLASS CARDS */
  .card{
    background: linear-gradient(180deg, rgba(11,17,38,.55), rgba(10,15,32,.45));
    border: 1px solid rgba(32,40,77,.65);
    border-radius: 16px; padding:14px; position:relative; overflow:hidden;
    box-shadow: 0 16px 36px -22px #000, 0 0 0 1px rgba(15,26,54,.55) inset;
    backdrop-filter: blur(6px) saturate(120%);
  }
  .badge{position:absolute; top:10px; right:10px; font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid #2a376a; background:#0d1633b0; color:#b8c7ff}
  .title{font-weight:900; font-size:18px; margin:2px 32px 6px 0}
  .meta{color:#cfe0ff; font-size:12px; display:flex; gap:8px; flex-wrap:wrap; margin:4px 0 8px}
  .tag{font-size:12px; padding:2px 8px; border-radius:999px; border:1px solid #2b3767; background:#0e1633aa}
  .why{color:#e7efff; font-size:14px; margin:4px 0 12px}
  .actions{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
  .count{font-weight:900; color:var(--hot)}
  .liked{background:linear-gradient(90deg,#1cc9a3,#80f)!important; color:#021611!important; border-color:#44e4d8!important}

  /* Floating Trophy ‚Äî COSMIC PURPLE */
  .fab{position:fixed; right:14px; bottom:84px; z-index:25}
  .fab button{
    border-radius:999px; padding:12px 16px; font-size:16px;
    background: linear-gradient(135deg, var(--cosmicPurple1), var(--cosmicPurple2));
    border: none; color:#0b0b16; font-weight:900;
    box-shadow: 0 6px 22px -6px rgba(123,92,255,.8), 0 0 0 1px rgba(167,139,250,.4) inset;
  }

  /* Bottom Sheet Leaderboard */
  .sheet{position:fixed; left:0; right:0; bottom:-70vh; height:70vh; background:var(--glass); border-top:1px solid var(--line); backdrop-filter:blur(10px) saturate(160%); border-top-left-radius:14px; border-top-right-radius:14px; z-index:24; transition:bottom .25s ease}
  .sheet.open{bottom:0}
  .sheet .drag{width:44px; height:5px; background:#30406f; border-radius:999px; margin:8px auto}
  .sheet .inside{max-width:1100px; margin:0 auto; padding:8px 14px 20px}
  .lead-row{display:flex; justify-content:space-between; gap:8px; padding:6px 0; border-bottom:1px dashed #213056}
  .lead-name{font-weight:800} .lead-score{font-weight:900; color:var(--hot)}

  /* Footer */
  footer{position:sticky; bottom:0; background:var(--glass2); border-top:1px solid var(--line); z-index:20}
  footer .wrap{display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap}

  /* Phone tweaks */
  @media (max-width:640px){
    .brand h1{font-size:16px}
    .btn{padding:12px 14px}
    .title{font-size:19px}
    .why{font-size:15px}
  }
</style>
</head>
<body>
<div class="nebula" aria-hidden="true"></div>
<canvas id="stars" aria-hidden="true"></canvas>
<!-- bursts now ABOVE content -->
<canvas id="bursts" aria-hidden="true"></canvas>

<header>
  <div class="wrap">
    <div class="toprow">
      <div class="brand"><span class="emoji">ü™ê</span><h1>ARMAJ Trip Picker</h1></div>
      <button id="share" class="btn hot">üîó Share My Votes</button>
    </div>
    <div class="bar">
      <input id="q" type="search" placeholder="Search destinations, states, vibes‚Ä¶" />
      <button id="clear" class="btn">Clear</button>
      <button id="randomize" class="btn ghost">üé≤ Randomize</button>
      <button id="importBtn" class="btn">‚¨áÔ∏è Import Votes</button>
      <span class="hint">Group voting: each friend shares; one person imports all.</span>
    </div>
  </div>
</header>

<main>
  <div class="grid" id="grid"></div>
</main>

<!-- Floating Trophy -->
<div class="fab"><button id="toggleSheet">üèÜ Leaderboard</button></div>

<!-- Bottom Sheet Leaderboard -->
<div id="sheet" class="sheet" aria-hidden="true">
  <div class="drag"></div>
  <div class="inside">
    <h3 style="margin:4px 0 6px">Group Leaderboard</h3>
    <div id="leaderboard"></div>
    <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap">
      <button id="sortVotes" class="btn">Sort by Votes</button>
      <button id="resetVotes" class="btn">üóëÔ∏è Reset My Device</button>
      <button id="resetGroup" class="btn">üóëÔ∏è Reset Group</button>
    </div>
    <details style="margin-top:10px">
      <summary>How group votes work</summary>
      <p class="hint">Each device stores its own 0/1 votes. ‚ÄúShare My Votes‚Äù copies a link with your choices. Paste friends‚Äô links via ‚ÄúImport Votes‚Äù to merge. Leaderboard shows the sum.</p>
    </details>
  </div>
</div>

<footer>
  <div class="wrap">
    <div class="hint">Tap üëç to vote (tap again to un-vote). Long-press üëç to reset that card.</div>
    <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap">
      <span id="groupCount" class="hint"></span>
    </div>
  </div>
</footer>

<script>
/* ---------- DATA ---------- */
const DESTS = [
  {id:'hampi-deep', name:'Hampi + Anegundi/Sanapur + Sandur', state:'Karnataka', why:'Boulder valleys, ruins, river-island hush; red-ore canyon drives.', tags:['psy','culture','mountains','rivers','zero-crowd']},
  {id:'gokarna-arc', name:'Gokarna Quiet Arc + Kumta‚ÄìHonnavar Coves', state:'Karnataka Coast', why:'Cliff trails to pocket beaches, bioluminescence nights (if lucky).', tags:['beach','psy','zero-crowd']},
  {id:'vattakanal', name:'Vattakanal + Poombarai', state:'Tamil Nadu', why:'Cloud forests, boho caf√©s, jams; Kodai without crowds.', tags:['mountains','forest','psy','zero-crowd']},
  {id:'sainj', name:'Sainj Valley (GHNP back-valley)', state:'Himachal', why:'Cedar woods, stone hamlets, massive starfields.', tags:['mountains','forest','zero-crowd']},
  {id:'kasar-binsar', name:'Kasar Devi Ridge + Binsar', state:'Uttarakhand', why:'Old hippie-trail energy; Himalayan sunsets from pine ridges.', tags:['mountains','psy','forest','zero-crowd']},
  {id:'meghalaya', name:'Meghalaya: Shnongpdeng ‚Üí Dawki ‚Üí Nongriat', state:'Meghalaya', why:'Living root bridges, glass-clear rivers, easy caves.', tags:['rivers','forest','psy','zero-crowd']},
  {id:'andaman-slow', name:'Andamans: Neil (Shaheed) + Long Island', state:'Andaman & Nicobar', why:'Forest-to-beach hikes, reef flats, plankton nights.', tags:['beach','forest','zero-crowd']},
  {id:'valparai', name:'Valparai + Sholayar', state:'TN/Kerala Border', why:'Tea highlands, rainforest gullies, lion-tailed macaques.', tags:['forest','mountains','zero-crowd']},
  {id:'dhanushkodi', name:'Dhanushkodi + Gulf of Mannar', state:'Tamil Nadu', why:'End-of-the-land sandspit, glassy lagoons, wind & kites.', tags:['beach','psy','zero-crowd']},
  {id:'chettinad', name:'Chettinad Mansions (Karaikudi)', state:'Tamil Nadu', why:'Palatial homes, Athangudi tiles, craft cycles.', tags:['culture','zero-crowd']},
  {id:'valiyaparamba', name:'Valiyaparamba + Kavvayi Backwaters', state:'North Kerala', why:'Backwaters without Alleppey crowds; islands & sandbars.', tags:['rivers','beach','zero-crowd']},
  {id:'bhogwe', name:'Bhogwe‚ÄìNivati‚ÄìVengurla Arc', state:'South Maharashtra', why:'Empty coves, laterite cliffs, teal water; pre-2005 Goa vibe.', tags:['beach','zero-crowd']},
  {id:'kutch', name:'Kutch Crafts + White Rann', state:'Gujarat', why:'Salt-desert moonscapes with living craft villages.', tags:['desert','culture','zero-crowd']},
  {id:'dzongu', name:'Dzongu (Lepcha Reserve)', state:'North Sikkim', why:'Sacred groves, hot springs, rivers; Lepcha culture.', tags:['mountains','forest','zero-crowd']},

  {id:'koyna', name:'Koyna‚ÄìVasota', state:'Maharashtra', why:'Boat across Koyna backwaters + jungle trek to cliff-top fort.', tags:['forest','rivers','zero-crowd']},
  {id:'chandoli', name:'Chandoli National Park', state:'Maharashtra', why:'Maratha forts swallowed by forest; gaur & civet nights.', tags:['forest','zero-crowd']},
  {id:'radhanagari', name:'Radhanagari Bison Sanctuary', state:'Maharashtra', why:'Foggy grasslands, gaur herds, blue-hour plateaus.', tags:['forest','zero-crowd']},
  {id:'amboli', name:'Amboli Ghats', state:'Maharashtra', why:'Shola cloud-forest, moody winter hikes.', tags:['forest','mountains','zero-crowd']},
  {id:'phansad', name:'Phansad Wildlife Sanctuary', state:'Maharashtra', why:'Coastal forest + watchtowers; sea-breeze mornings.', tags:['forest','rivers','zero-crowd']},
  {id:'bhimashankar', name:'Bhimashankar WLS', state:'Maharashtra', why:'Sacred groves, Malabar giant squirrels, mossy trails.', tags:['forest','mountains','zero-crowd']},
  {id:'tamhini', name:'Tamhini‚ÄìMulshi Belt', state:'Maharashtra', why:'Fern gullies, mirror lakes, blue-hour photography.', tags:['forest','rivers','zero-crowd']},
  {id:'nagzira', name:'Navegaon‚ÄìNagzira TR', state:'Maharashtra', why:'Twin lakes, bamboo‚Äìsal mosaics, superb birding.', tags:['forest','rivers','zero-crowd']},
  {id:'tipeshwar', name:'Tipeshwar WLS', state:'Maharashtra', why:'Compact teak with frequent big-cat sightings.', tags:['forest','psy']},
  {id:'umred', name:'Umred‚ÄìKarhandla', state:'Maharashtra', why:'Raw teak corridors; old-school forest energy.', tags:['forest','zero-crowd']},
  {id:'melghat', name:'Melghat TR (Satpura)', state:'Maharashtra', why:'Deep valleys, sparkling night skies, tribal hamlets.', tags:['forest','mountains','zero-crowd']},
  {id:'pench-mh', name:'Pench (Sillari, MH side)', state:'Maharashtra', why:'Kipling woods; calmer gates than MP side.', tags:['forest','rivers']}
];

/* ---------- STATE ---------- */
const $ = s => document.querySelector(s);
const votesKey = 'votes_device_v3';
const groupKey = 'votes_group_v3';
let myVotes = loadJson(votesKey) || {};
let groupMembers = loadJson(groupKey) || [];
function loadJson(k){ try{return JSON.parse(localStorage.getItem(k)||'null')}catch(e){return null} }
function saveJson(k,v){ localStorage.setItem(k, JSON.stringify(v)) }

/* ---------- CANVASES + ANIM ---------- */
const starCanvas = document.getElementById('stars'), starCtx = starCanvas.getContext('2d');
const burstsCanvas = document.getElementById('bursts'), burstsCtx = burstsCanvas.getContext('2d');
function fit(){ starCanvas.width=innerWidth; starCanvas.height=innerHeight; burstsCanvas.width=innerWidth; burstsCanvas.height=innerHeight }
addEventListener('resize', fit); fit();

/* Stars + shooting stars */
const stars = Array.from({length: 220}).map(()=>({ x:Math.random()*innerWidth, y:Math.random()*innerHeight, z:Math.random()*0.6+0.4, tw:Math.random()*0.6+0.4 }));
let shooters = [];
function maybeShoot(){ if(Math.random()<0.01){ shooters.push({x:Math.random()*innerWidth*0.6, y:Math.random()*innerHeight*0.4, vx:3+Math.random()*2, vy:1+Math.random()*1.5, a:1}); } }
function drawStars(t){
  starCtx.clearRect(0,0,starCanvas.width,starCanvas.height);
  starCtx.fillStyle='#fff';
  stars.forEach(s=>{
    s.y = (s.y + 0.03*s.z) % innerHeight;
    const a = 0.6 + 0.4*Math.sin((t/7000 + s.x*0.002)*s.tw);
    starCtx.globalAlpha = a*0.9;
    starCtx.fillRect(s.x, s.y, 1.2*s.z, 1.2*s.z);
  });
  maybeShoot();
  shooters.forEach(sh=>{
    starCtx.globalAlpha = sh.a;
    const grad = starCtx.createLinearGradient(sh.x,sh.y, sh.x-60,sh.y-20);
    grad.addColorStop(0,'#aef'); grad.addColorStop(1,'transparent');
    starCtx.strokeStyle = grad; starCtx.lineWidth = 2;
    starCtx.beginPath(); starCtx.moveTo(sh.x,sh.y); starCtx.lineTo(sh.x-60, sh.y-20); starCtx.stroke();
    sh.x += sh.vx; sh.y += sh.vy; sh.a *= 0.97;
  });
  shooters = shooters.filter(s=> s.a>0.05 && s.x<innerWidth+80 && s.y<innerHeight+80);
}

/* Vote bursts (front canvas, glowing) */
burstsCtx.globalCompositeOperation = 'lighter';
let particles=[];
function burst(x,y,type='confetti',scale=1){
  const N = 24+Math.floor(Math.random()*16);
  for(let i=0;i<N;i++){
    const ang = Math.random()*Math.PI*2, sp=(Math.random()*2+1.5)*scale;
    if(type==='emoji'){
      const emojis=['‚ú®','‚≠ê','üåü','ü™ê','üå†','üåô','‚òÑÔ∏è','üí´', Math.random()<0.08?'üí©':'‚ú®'];
      particles.push({x,y,vx:Math.cos(ang)*sp, vy:Math.sin(ang)*sp-1.5, g:0.05, a:1, t:'e', txt:emojis[Math.floor(Math.random()*emojis.length)], sz:16+Math.random()*10});
    }else{
      const hues=[170,195,260,320]; const h=hues[Math.floor(Math.random()*hues.length)];
      particles.push({x,y,vx:Math.cos(ang)*sp, vy:Math.sin(ang)*sp-1.2, g:0.06, a:1, t:'d', c:`hsl(${h} 90% 70%)`, r:2+Math.random()*3});
    }
  }
}
function drawBursts(){
  burstsCtx.clearRect(0,0,burstsCanvas.width,burstsCanvas.height);
  particles.forEach(p=>{
    p.vy+=p.g; p.x+=p.vx; p.y+=p.vy; p.a*=0.985;
    burstsCtx.globalAlpha=p.a;
    if(p.t==='d'){ burstsCtx.fillStyle=p.c; burstsCtx.beginPath(); burstsCtx.arc(p.x,p.y,p.r,0,Math.PI*2); burstsCtx.fill(); }
    else { burstsCtx.font=`${p.sz}px system-ui, emoji`; burstsCtx.fillText(p.txt,p.x,p.y); }
  });
  particles = particles.filter(p=>p.a>0.04 && p.y<innerHeight+60 && p.x>-60 && p.x<innerWidth+60);
}

/* ---------- GROUP & RENDER ---------- */
function groupTotalFor(id){ let sum = myVotes[id]?1:0; for(const m of groupMembers){ if(m[id]) sum += 1; } return sum; }
function topScore(){ return Math.max(0, ...DESTS.map(d=>groupTotalFor(d.id))); }

function render(){
  const q = ($('#q').value||'').trim().toLowerCase();
  const grid = $('#grid'); grid.innerHTML='';
  const arr = DESTS
    .filter(d => !q || d.name.toLowerCase().includes(q) || d.state.toLowerCase().includes(q) || d.tags.join(' ').includes(q))
    .sort((a,b)=> +($('#sortVotes').dataset.sorted==='true') ? (groupTotalFor(b.id)-groupTotalFor(a.id)) : 0);

  arr.forEach(d=>{
    const mine = !!myVotes[d.id];
    const total = groupTotalFor(d.id);
    const top = total === topScore() && total>0;
    const el = document.createElement('div');
    el.className='card';
    el.innerHTML=`
      <div class="badge">${d.state}${top?' ¬∑ <span class="crown">üëë Top</span>':''}</div>
      <div class="title">${d.name}</div>
      <div class="meta">${d.tags.map(t=>`<span class="tag">#${t}</span>`).join(' ')}</div>
      <p class="why">${d.why}</p>
      <div class="actions">
        <button class="btn ${mine?'liked':''}" data-vote="${d.id}" aria-pressed="${mine}">${mine?'‚úÖ Voted':'üëç Vote'}</button>
        <span class="count" id="c_${d.id}">${total}</span>
        <a class="btn ghost" target="_blank" rel="noopener" href="${google(d.name)}">üîé Google</a>
        <button class="btn ghost" data-reset="${d.id}" title="Reset this card">‚ôªÔ∏è</button>
      </div>`;
    addLongPress(el.querySelector(`[data-vote="${d.id}"]`), ()=>{ delete myVotes[d.id]; saveJson(votesKey,myVotes); render(); });
    grid.appendChild(el);
  });

  renderLeaderboard();
  $('#groupCount').textContent = `Group members merged: ${1 + groupMembers.length}`;
}

function renderLeaderboard(){
  const container = $('#leaderboard'); container.innerHTML='';
  const sorted = [...DESTS].sort((a,b)=>groupTotalFor(b.id)-groupTotalFor(a.id)).slice(0,12);
  sorted.forEach((d,i)=>{
    const row = document.createElement('div');
    row.className='lead-row';
    row.innerHTML = `<div class="lead-name">${i+1}. ${d.name}</div><div class="lead-score">${groupTotalFor(d.id)}</div>`;
    container.appendChild(row);
  });
}

/* ---------- HELPERS & EVENTS ---------- */
function google(n){ return `https://www.google.com/search?q=${encodeURIComponent(n+' India')}` }
function addLongPress(el, cb){ let t; el.addEventListener('touchstart', ()=>{ t=setTimeout(cb,600) }, {passive:true}); ['touchend','touchcancel','touchmove'].forEach(ev=> el.addEventListener(ev, ()=> clearTimeout(t), {passive:true})); }

document.addEventListener('click', (e)=>{
  const id = e.target?.dataset?.vote;
  if(id){
    const wasOn = !!myVotes[id];
    if(wasOn) delete myVotes[id]; else myVotes[id]=1;
    saveJson(votesKey,myVotes);
    const r = e.target.getBoundingClientRect();
    const x = r.left + r.width/2, y = r.top + window.scrollY + r.height/2;
    burst(x,y, Math.random()<0.5?'confetti':'emoji', wasOn?0.7:1.1);
    render(); return;
  }
  const reset = e.target?.dataset?.reset;
  if(reset){ delete myVotes[reset]; saveJson(votesKey,myVotes); render(); return; }
});

$('#q').addEventListener('input', render);
$('#clear').addEventListener('click', ()=>{ $('#q').value=''; render(); });
$('#randomize').addEventListener('click', ()=>{ DESTS.sort(()=>Math.random()-.5); render(); });

$('#share').addEventListener('click', ()=>{
  const url = `${location.origin}${location.pathname}?votes=${encodeURIComponent(JSON.stringify(myVotes))}`;
  navigator.clipboard.writeText(url).then(()=> alert('Copied your votes link! Paste this in the group.'));
});

$('#importBtn').addEventListener('click', ()=>{
  const link = prompt('Paste a friend‚Äôs votes link (from ‚ÄúShare My Votes‚Äù).');
  if(!link) return;
  try{
    const u = new URL(link);
    const raw = u.searchParams.get('votes'); if(!raw) return alert('No votes found in that link.');
    const obj = JSON.parse(decodeURIComponent(raw));
    const already = groupMembers.some(m => JSON.stringify(m)===JSON.stringify(obj));
    if(!already){ groupMembers.push(obj); saveJson(groupKey, groupMembers); }
    render();
  }catch(err){ alert('Could not import. Make sure you pasted the exact link.'); }
});

$('#resetVotes').addEventListener('click', ()=>{ if(confirm('Reset ONLY this device‚Äôs votes?')){ myVotes={}; saveJson(votesKey,myVotes); render(); } });
$('#resetGroup').addEventListener('click', ()=>{ if(confirm('Remove all imported friends and keep only this device?')){ groupMembers=[]; saveJson(groupKey, groupMembers); render(); } });

$('#sortVotes').addEventListener('click', (e)=>{
  const on = e.target.dataset.sorted === 'true';
  e.target.dataset.sorted = on ? 'false' : 'true';
  e.target.textContent = on ? 'Sort by Votes' : 'Sorted ‚úì';
  render();
});

/* Bottom sheet toggle */
const sheet = $('#sheet'), toggle = $('#toggleSheet');
toggle.addEventListener('click', ()=> sheet.classList.toggle('open'));

/* Loops */
function loop(ts){ drawStars(ts); drawBursts(); requestAnimationFrame(loop); }
requestAnimationFrame(loop);

/* One-time import via URL */
(function initImportFromURL(){
  const qs = new URLSearchParams(location.search);
  if(qs.get('votes')){
    const obj = JSON.parse(decodeURIComponent(qs.get('votes')));
    const same = groupMembers.some(m => JSON.stringify(m)===JSON.stringify(obj));
    if(!same){ groupMembers.push(obj); saveJson(groupKey, groupMembers); }
    history.replaceState({}, '', location.pathname);
  }
})();
render();
</script>
</body>
</html>
